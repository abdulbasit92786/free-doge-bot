<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin Panel | Free Doge</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .card { max-width: 600px; margin: auto; background: #222; padding: 20px; border-radius: 15px; color: white; }
    .user-card { background: #333; padding: 15px; border-radius: 10px; margin-bottom: 10px; }
    button { margin-top: 10px; padding: 8px 15px; background: limegreen; color: black; border: none; border-radius: 5px; cursor: pointer; }
    .converted { background: #00ccff; color: white; }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyACjHqz0QKAH2OnSpomh3OioYUW1qfmd6w",
      authDomain: "freedogeclam.firebaseapp.com",
      databaseURL: "https://freedogeclam-default-rtdb.firebaseio.com",
      projectId: "freedogeclam",
      storageBucket: "freedogeclam.appspot.com",
      messagingSenderId: "764273012962",
      appId: "1:764273012962:web:398a856b5b7c37c4396ebb",
      measurementId: "G-MC0HWPRTNT"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const adminId = 7584161210; // Only allow access for you
    const currentUser = Telegram.WebApp.initDataUnsafe.user.id;

    if (currentUser != adminId) {
      document.body.innerHTML = "<h3 style='text-align:center;color:red;'>Access Denied: Admins only!</h3>";
    } else {
      const usersRef = ref(db, "users");
      const listContainer = document.getElementById("userList");

      get(usersRef).then((snapshot) => {
        if (!snapshot.exists()) {
          listContainer.innerHTML = "<p>No users found.</p>";
          return;
        }

        const users = snapshot.val();
        for (const userId in users) {
          const user = users[userId];
          const div = document.createElement("div");
          div.className = "user-card";
          div.innerHTML = `
            <p><strong>ID:</strong> ${userId}</p>
            <p><strong>Taps:</strong> ${user.tapBalance || 0}</p>
            <p><strong>Tasks:</strong> ${user.taskBalance || 0}</p>
            <p><strong>Tokens:</strong> ${user.tokens || 0}</p>
            <button onclick="convert('${userId}', ${user.tapBalance || 0})">Convert Taps âž¤ Tokens</button>
          `;
          listContainer.appendChild(div);
        }
      });

      window.convert = function(userId, tapAmount) {
        if (tapAmount <= 0) return alert("No tap earnings to convert!");
        const userRef = ref(db, `users/${userId}`);
        get(userRef).then(snapshot => {
          const data = snapshot.val() || {};
          const newTokens = (data.tokens || 0) + tapAmount;
          set(userRef, {
            ...data,
            tapBalance: 0,
            tokens: newTokens
          }).then(() => {
            alert("Converted!");
            location.reload();
          });
        });
      }
    }
  </script>
</head>
<body>
  <div class="card">
    <h2>Admin Panel</h2>
    <div id="userList"></div>
  </div>
</body>
</html>
